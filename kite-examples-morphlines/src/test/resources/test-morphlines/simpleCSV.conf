# Defined for local consumption, there is no ZooKeeper. The important part is just the
# path defined by SOLR_HOME_DIRECTORY so the schema can be found.

    "SOLR_COLLECTION" : collection1
    "SOLR_HOME_DIR" : "src/test/resources/solr/collection1"
    "SOLR_URL" : "http://127.0.0.1:8983/solr/"${SOLR_COLLECTION}
    "ZK_HOST" : "127.0.0.1:2181/solr"

    "SOLR_LOCATOR" {
        zkHost : ${ZK_HOST}
        solrUrl : ${SOLR_URL}
        collection : ${SOLR_COLLECTION}
        solrHomeDir : ${SOLR_HOME_DIR}
    }


    morphlines : [
        {
            id : morphline1
            commands : [
                {
                    readLine {
                        charset : "UTF-8"
                    }
                },
                { # Parse incoming record into three fields
                    split {
                      inputField : message
                      outputFields : [title, last_edited, text]
                      separator : ","
                      isRegex : false
                      addEmptyStrings : false
                      trim : true
                    }
                },
                { # Now transform last_edited field into a Solr-style date
                    convertTimestamp {
                        field : "last_edited"
                        outputFormat : "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"
                        inputTimezone : "America/Los_Angeles"
                        outputTimezone : UTC
                        inputFormats : [
                            "dd-MMM-yyyy"
                        ]
                    }
                },

                { #Add the unix timestamp to a field called (by default) "timestamp"
                    addCurrentTime {}
                },
                { # Convert Unix timestamp into a Solr-style date
                    convertTimestamp {
                        field : timestamp
                        outputFormat : "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"
                        inputTimezone : UTC
                        outputTimezone : UTC
                        inputFormats : [
                            unixTimeInMillis
                        ]
                    }
                },
                {
                    generateUUID {
                      field : id  # Not entirely necessary, id is the default
                    }
                },
                {
                    sanitizeUnknownSolrFields {
                        #   Location from which to fetch Solr schema
                        solrLocator : ${SOLR_LOCATOR}
                    }
                },
                #   load the record into a SolrServer or MapReduce SolrOutputFormat.
                #   Commenting out the loadSolr to be able to estimate if it's creating backpressure on flume 
                #   UNCOMMENT WHEN READY TO LOAD INTO SOLR
                #
                #{
                #    loadSolr {
                #        solrLocator : ${SOLR_LOCATOR}
                #    }
                #}
            ]
            #importCommands : ["com.cloudera.**", "org.apache.solr.**"]
            importCommands : ["org.kitesdk.**", "org.apache.solr.**" ]
        }
    ]
